<html>
  <head>
    <meta charset="utf-8" />
    <title>PDF Modifier</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
  </head>

  <body id="dropContainer" style="display: grid; place-content: center">
    <div style="display: flex; flex-direction: column; gap: 16px">
      <label>
        Drag & Drop PDF slides (select multiple for bulk) <br />
        <input id="file-input" type="file" multiple accept="application/pdf" />
      </label>

      <label>
        Margin on sides <br />
        <input id="margin-x" type="number" min="0" step="0.5" value="5" />
      </label>
      <label>
        Margin top & bottom <br />
        <input id="margin-y" type="number" min="0" step="0.5" value="2" />
      </label>

      <button onclick="downloadPdf()">Download</button>
    </div>
  </body>

  <script>
    const { degrees, PDFDocument, rgb, StandardFonts } = PDFLib;

    const fileInput = document.getElementById("file-input");
    const marginInputX = document.getElementById("margin-x");
    const marginInputY = document.getElementById("margin-y");

    function downloadPdf() {
      if (fileInput.files.length) {
        for (const file of fileInput.files) {
          console.log("Adding margin: ", file);
          modifyPdf(file);
        }
      }
    }

    async function modifyPdf(file) {
      // Fetch an existing PDF document
      const sourcePdf = await file.arrayBuffer();

      // Load a PDFDocument from the existing PDF bytes
      const pdfDoc = await PDFDocument.load(sourcePdf);

      // Embed the Helvetica font
      const helveticaFont = await pdfDoc.embedFont(StandardFonts.Helvetica);

      // Get the first page of the document
      const pages = pdfDoc.getPages();

      // Define the margin size (in inches times 72, for PDF units)
      const marginInchesX = marginInputX.value;
      const marginInchesY = marginInputY.value;

      const marginSizeX = marginInchesX * 72;
      const marginSizeY = marginInchesY * 72;

      pages.forEach((page) => {
        page.setSize(
          page.getWidth() + marginSizeX,
          page.getHeight() + marginSizeY
        );
        page.translateContent(marginSizeX / 2, marginSizeY / 2);
      });

      // Serialize the PDFDocument to bytes (a Uint8Array)
      const pdfBytes = await pdfDoc.save();

      // Trigger the browser to download the PDF document
      download(pdfBytes, "modified-" + file.name + ".pdf", "application/pdf");
    }

    const dropContainer = document.getElementById("dropContainer");
    //https://stackoverflow.com/questions/8006715/drag-drop-files-into-standard-html-file-input
    // dragover and dragenter events need to have 'preventDefault' called
    // in order for the 'drop' event to register.
    // See: https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Drag_operations#droptargets
    dropContainer.ondragover = function (e) {
      e.preventDefault();
    };
    dropContainer.ondragenter = function (e) {
      e.preventDefault();
    };

    dropContainer.ondrop = function (e) {
      e.preventDefault();

      // pretty simple -- but not for IE :(
      fileInput.files = e.dataTransfer.files;

      // If you want to use some of the dropped files
      const dT = new DataTransfer();
      dT.items.add(e.dataTransfer.files[0]);
      dT.items.add(e.dataTransfer.files[3]);
      fileInput.files = dT.files;
    };
  </script>
</html>
